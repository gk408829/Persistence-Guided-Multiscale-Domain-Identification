2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:155 - Log file created: ./persist_output_breast_cancer/persist_pipeline.log
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3080 - Validating input data...
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3094 - Input data validated: 3798 spots, 22240 genes
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3121 - ============================================================
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3122 - PERSIST PIPELINE STARTED
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3123 - ============================================================
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3124 - Tissue type: breast_cancer
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3125 - Number of scales: 5
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3126 - Top genes: 3000
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3127 - Output directory: ./persist_output_breast_cancer
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3132 - Using knowledge base for: breast_cancer
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3141 - Loaded 8 stability markers, 4 reference markers
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3151 - 
========================================
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3152 - PHASES 0-1: PREPROCESSING & MESH CONSTRUCTION
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:3153 - ========================================
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:1073 - Input validated: 3798 spots, 22240 genes
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:1099 - ============================================================
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:1100 - PHASE 0-1: SPATIAL PREPROCESSING AND MESH CONSTRUCTION
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:1101 - ============================================================
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:1104 - Step 1: Selecting informative genes...
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:632 - 
        ╔════════════════════════════════════════════════════════╗
        ║     TISSUE-ADAPTIVE GENE SELECTION STRATEGY            ║
        ╠════════════════════════════════════════════════════════╣
        ║  Tissue Pattern: fragmented_patches             ║
        ║  Strategy: robust                                     ║
        ║  Pre-filter: 4000                                         ║
        ║  Moran's I Base: 0.25                                   ║
        ║  Percentile Cutoff: 75                               th ║
        ║  Target Range: 3000-5000 genes                          ║
        ╚════════════════════════════════════════════════════════╝
        
2026-01-22 21:51:28 - PERSIST - INFO - persist_final.py:643 - Stage 1: Variance pre-filter (top 4000 HVGs)...
2026-01-22 21:51:29 - PERSIST - INFO - persist_final.py:651 -   → Pre-filtered: 22240 → 4000 genes
2026-01-22 21:51:29 - PERSIST - INFO - persist_final.py:671 - Stage 2: Spatial autocorrelation analysis...
2026-01-22 21:51:29 - PERSIST - INFO - persist_final.py:702 -   → Building spatial neighbor graph...
2026-01-22 21:51:29 - PERSIST - INFO - persist_final.py:712 -   → Using serial execution (n_jobs=1) for stability on 4000 genes.
2026-01-22 21:51:29 - PERSIST - INFO - persist_final.py:714 -   → Computing Moran's I for 4000 genes (n_jobs=1)...
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:749 -   → Moran's I distribution: max=0.866, median=0.013, mean=0.049, min=-0.022
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:821 -   → Spatial quality: weak (median Moran's I = 0.013)
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:918 -   → Applying ROBUST percentile selection: top 25%
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:925 -   → Percentile threshold: Moran's I > 0.051 (75th percentile)
2026-01-22 21:53:36 - PERSIST - WARNING - persist_final.py:937 -   → Very weak spatial structure. Using fallback threshold: 0.000
2026-01-22 21:53:36 - PERSIST - WARNING - persist_final.py:961 -   → Only 2679 genes selected. Expanding to 3000 (top by Moran's I).
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:989 - 
  ✓ SELECTION COMPLETE:
    • Selected: 3000 genes
    • Moran's I range: -0.001 to 0.866
    • Moran's I median: 0.028
    • Retention rate: 75.0%
            
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:1116 - Selected 3000 genes for analysis
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:1119 - Step 2: Loading configuration for tissue type: breast_cancer
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:1136 - Mesh strategy: multi_component, min_k: 3, auto_bridge: True
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:1143 - Step 3: Constructing adaptive mesh...
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:1177 - Starting with 3798 spatial spots
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:1247 - Graph stable at k=3 (Retention: 99.4%)
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:1267 - Pruning: Dropped 22 unconnected/noise spots (0.6% of total)
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:1278 - Characteristic scale (median nearest-neighbor distance): 273.00
2026-01-22 21:53:36 - PERSIST - INFO - persist_final.py:1284 - Maximum alpha squared: 298116.0000
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1303 - Mesh constructed: 3776 nodes, 11115 edges, 7338 triangles.
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1151 - Step 4: Applying heat diffusion smoothing...
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1374 - Heat diffusion smoothing applied successfully
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1154 - Preprocessing complete. Final dataset: 3776 spots, 3000 genes
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:3166 - 
========================================
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:3167 - PHASE 2: TOPOLOGICAL SCALE ANALYSIS
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:3168 - ========================================
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1436 - ============================================================
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1437 - PHASE 2: TOPOLOGICAL SCALE ANALYSIS
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1438 - ============================================================
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1441 - Computing persistent homology...
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1456 - Topological structure: Found 7199 persistent H₁ features (finite lifetimes)
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1464 - H₁ persistence statistics: mean lifetime = 6208.8791, max lifetime = 116941.8932, min lifetime = 0.0101
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1504 - Computing optimal scales (requested: 5 scales)
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1555 - Optimal scales computed: 90180.0900 to 197779.8750 (5 scales, geometric spacing)
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:3179 - 
========================================
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:3180 - PHASE 3: MULTISCALE TOTAL VARIATION
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:3181 - ========================================
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1702 - Topological Boundary Mask: identified 216 edge nodes to suppress (5.7% of total)
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1725 - ============================================================
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1726 - PHASE 3: MULTISCALE TOTAL VARIATION ANALYSIS
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1727 - ============================================================
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1749 - Using CPU for TV computations
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1765 - Scale weights assigned: [1.31 1.31 2.39 0.   0.  ]
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1832 - Stability score computed: mean=0.616, std=0.276
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1896 - Frontier TV computed: mean magnitude=0.348, max magnitude=1.000
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1843 - Multiscale TV analysis completed successfully
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1909 - Phase 3b: Bootstrapping for robustness assessment
2026-01-22 21:53:37 - PERSIST - INFO - persist_final.py:1917 - Running 100 bootstrap iterations (sample fraction: 0.85)
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:1952 - Robustness assessment complete: 1313 significant cores identified (34.8% of spots)
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:3190 - 
========================================
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:3191 - PHASE 4: BASIN DECOMPOSITION
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:3192 - ========================================
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2047 - ============================================================
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2048 - PHASE 4: BASIN DECOMPOSITION (TOPOGRAPHIC WATERSHED)
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2049 - ============================================================
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2056 - Performing watershed on 3776 spots
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2110 - Found 15 local maxima for watershed seeds
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2127 - Watershed segmentation identified 15 stability basins
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2143 - Basin decomposition complete. Domain sizes: min=63, max=455, mean=251.7
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:3200 - 
========================================
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:3201 - PHASE 5: VALIDATION & VISUALIZATION
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:3202 - ========================================
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2202 - ============================================================
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2203 - PHASE 5a: QUANTITATIVE METRICS AND ANNOTATION
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2204 - ============================================================
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2207 - Step 1: Biological annotation alignment...
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2330 - Aligning domains with 6 biological annotations
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2387 - Annotation complete: 15 unique annotations
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2211 - Step 2: Structural metric computation...
2026-01-22 21:53:38 - PERSIST - INFO - persist_final.py:2400 - Computing baseline leiden clustering...
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2404 - Baseline clustering created: 13 clusters
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2419 - Baseline ARI: 0.4255
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2444 - Topological Orthogonality Index: 0.8651
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2473 - Scale Local Coherence: 0.9996
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2217 - Step 3: Coupling metric computation...
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2500 - Gradient-Reference Coupling: rho=0.3041, p=1.2753e-81
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2541 - Strongest stability correlation: Fibroblast_Stroma = -0.3357
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2223 - Step 4: Saving metrics...
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2251 - Metrics saved to ./persist_output_breast_cancer/persist_metrics.json
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2272 - Metric Summary:
  Baseline ARI: 0.4255
  Topological Orthogonality Index: 0.8651
  Scale Local Coherence: 0.9996
  Gradient-Reference Coupling: 0.3041
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2591 - ============================================================
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2592 - PHASE 5b: GENERATING VISUALIZATIONS & REPORT
2026-01-22 21:54:35 - PERSIST - INFO - persist_final.py:2593 - ============================================================
2026-01-22 21:54:58 - PERSIST - INFO - persist_final.py:2892 - Generating Biological Marker Dotplot...
2026-01-22 21:54:59 - PERSIST - INFO - persist_final.py:2964 - Marker dotplot saved successfully (Sorted 15 domains).
2026-01-22 21:55:00 - PERSIST - INFO - persist_final.py:2637 - Report saved: ./persist_output_breast_cancer/PERSIST_Analysis_Report.pdf
2026-01-22 21:55:00 - PERSIST - INFO - persist_final.py:2638 - Individual images saved to: ./persist_output_breast_cancer/visualizations
2026-01-22 21:55:00 - PERSIST - INFO - persist_final.py:3261 - Pipeline state saved to ./persist_output_breast_cancer/persist_final_state.npz
2026-01-22 21:55:00 - PERSIST - INFO - persist_final.py:3229 - 
============================================================
2026-01-22 21:55:00 - PERSIST - INFO - persist_final.py:3230 - PERSIST PIPELINE COMPLETE
2026-01-22 21:55:00 - PERSIST - INFO - persist_final.py:3231 - ============================================================
2026-01-22 21:55:00 - PERSIST - INFO - persist_final.py:3232 - Results saved to: ./persist_output_breast_cancer
2026-01-22 21:55:00 - PERSIST - INFO - persist_final.py:3531 - Pipeline completed successfully
